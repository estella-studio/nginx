## Version 2025/05/31 - Changelog: https://github.com/linuxserver/docker-baseimage-alpine-nginx/commits/3.22/root/defaults/nginx/nginx.conf.sample

### Based on alpine defaults
# https://git.alpinelinux.org/aports/tree/main/nginx/nginx.conf?h=3.22-stable

user abc;

# Set number of worker processes automatically based on number of CPU cores.
include /config/nginx/worker_processes.conf;

# Enables the use of JIT for regular expressions to speed-up their processing.
pcre_jit on;

# Configures default error logger.
error_log /config/log/nginx/error.log;

# Includes files with directives to load dynamic modules.
include /etc/nginx/modules/*.conf;

# Include files with config snippets into the root context.
include /etc/nginx/conf.d/*.conf;

events {
	# The maximum number of simultaneous connections that can be opened by
	# a worker process.
	worker_connections 1024;
}

http {
	# Includes mapping of file name extensions to MIME types of responses
	# and defines the default type.
	include /etc/nginx/mime.types;
	default_type application/octet-stream;

	# Name servers used to resolve names of upstream servers into addresses.
	# It's also needed when using tcpsocket and udpsocket in Lua modules.
	#resolver 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001;
	include /config/nginx/resolver.conf;

	# Don't tell nginx version to the clients. Default is 'on'.
	server_tokens off;

	# Specifies the maximum accepted body size of a client request, as
	# indicated by the request header Content-Length. If the stated content
	# length is greater than this size, then the client receives the HTTP
	# error code 413. Set to 0 to disable. Default is '1m'.
	client_max_body_size 0;

	# Sendfile copies data between one FD and other from within the kernel,
	# which is more efficient than read() + write(). Default is off.
	sendfile on;

	# Causes nginx to attempt to send its HTTP response head in one packet,
	# instead of using partial frames. Default is 'off'.
	tcp_nopush on;

	# all ssl related config moved to ssl.conf
	# included in server blocks where listen 443 is defined

	# Enable gzipping of responses.
	gzip on;

	# Set the Vary HTTP header as defined in the RFC 2616. Default is 'off'.
	gzip_vary on;

	# Helper variable for proxying websockets.
	map $http_upgrade $connection_upgrade {
		default upgrade;
		'' close;
	}

	# Enable http2 by default for all servers
	http2 on;

	http3 on;
	quic_retry on;

	# Sets the path, format, and configuration for a buffered log write.
	access_log /config/log/nginx/access.log;

	client_body_temp_path /tmp/nginx 1 2;
	proxy_temp_path /tmp/nginx-proxy;
	fastcgi_temp_path /tmp/nginx-fastcgi;
	uwsgi_temp_path /tmp/nginx-uwsgi;
	scgi_temp_path /tmp/nginx-scgi;

	proxy_cache_path /tmp/nginx-proxy-cache keys_zone=lsio-proxy:10m;
	fastcgi_cache_path /tmp/nginx-fcgi-cache keys_zone=lsio-fcgi:10m;
	scgi_cache_path /tmp/nginx-scgi-cache keys_zone=lsio-scgi:10m;
	uwsgi_cache_path /tmp/nginx-uwsgi-cache keys_zone=lsio-uwsgi:10m;

	# Includes virtual hosts configs.
	include /etc/nginx/http.d/*.conf;
	include /config/nginx/site-confs/*.conf;

	split_clients "${remote_addr}${request_uri}" $atr_backend_prod_pool {
		* http;
		* google_cloud_run;
	}

	map $atr_backend_prod_pool $atr_backend_prod_proxy_upstream {
		http http://atr_backend_prod_http;
		google_cloud_run https://atr_backend_prod_google_cloud_run;
	}

	map $atr_backend_prod_pool $atr_backend_prod_host_header {
		http $host;
		google_cloud_run atr-backend-744996511632.asia-southeast2.run.app;
	}

	map $atr_backend_prod_pool $atr_backend_prod_sni_name {
		http "";
		google_cloud_run atr-backend-744996511632.asia-southeast2.run.app;
	}

	upstream personal_website_prod {
		server syafahadyan.pages.dev;
		#server syafahadyan.github.io;
		#server syafahadyan.vercel.app;
	}

	upstream keycloak_prod {
		server himitsu.tailce5c0d.ts.net:8080;
	}

	upstream atr_backend_prod_google_cloud_run {
		server atr-backend-744996511632.asia-southeast2.run.app:443; # Google Cloud Run
	}

	upstream atr_backend_prod_http {
		server 35.219.86.106:8080; # Google Kubernetes Engine
		#server mizu.tailce5c0d.ts.net:8000; # On premise
		#server fuyu.tailce5c0d.ts.net:8080; # On premise
		#server natsu.tailce5c0d.ts.net:8080; # On premise
		#server tsubaki.tailce5c0d.ts.net:8000; # On premise
		#server ajisai.tailce5c0d.ts.net:8000; # On premise
		#server suisen.tailce5c0d.ts.net:8000; # On premise
		#server nadeshiko.tailce5c0d.ts.net:8000; # On premise
		#server sumire.tailce5c0d.ts.net:8000; # On premise
		#server tsutsuji.tailce5c0d.ts.net:8000; # On premise
		#server hitori.tailce5c0d.ts.net:8000; # On premise Kubernetes Cluster
	}

	upstream atr_backend_prod {
		server tsubaki.tailce5c0d.ts.net:8000; # On premise
		server ajisai.tailce5c0d.ts.net:8000; # On premise
		#server suisen.tailce5c0d.ts.net:8000; # On premise
		#server nadeshiko.tailce5c0d.ts.net:8000; # On premise
		#server sumire.tailce5c0d.ts.net:8000; # On premise
		#server tsutsuji.tailce5c0d.ts.net:8000; # On premise
		#server hitori.tailce5c0d.ts.net:8000; # On premise Kubernetes Cluster
	}

	upstream atr_backend_staging {
		#server 35.219.68.35:8080; # Google Kubernetes Engine
		server nanohana.tailce5c0d.ts.net:8000;
		#server kinmokusei.tailce5c0d.ts.net:8000;
	}

	upstream bcc_canteen_backend_prod {
		server tsubaki.tailce5c0d.ts.net:8080; # On premise
		server ajisai.tailce5c0d.ts.net:8080; # On premise
		#server suisen.tailce5c0d.ts.net:8000; # On premise
		#server nadeshiko.tailce5c0d.ts.net:8000; # On premise
		#server sumire.tailce5c0d.ts.net:8000; # On premise
		#server tsutsuji.tailce5c0d.ts.net:8000; # On premise
		#server hitori.tailce5c0d.ts.net:8000; # On premise Kubernetes Cluster
	}

	#upstream jenkins {
	#	server shikisha.tailce5c0d.ts.net:8080;
	#}

	upstream pve {
		#server pve.syafahadyan.com:443;
		server 10.0.0.5:8006;
	}

	upstream pbs {
		server 10.0.0.4:8007;
	}

	upstream router {
		server 10.0.0.1:80;
	}
	
	#upstream wordpress {
	#	server acheron-1.taile92515.ts.net:8001;
	#}

	#upstream filca {
	#	server acheron-1.taile92515.ts.net:3000;
	#}

	#upstream sqrt {
	#	server acheron-1.taile92515.ts.net:80;
	#}

	#upstream ai {
	#	server acheron-1.taile92515.ts.net:11434;
	#}

	upstream status {
		server hibiki.tailce5c0d.ts.net:3001;
	}

	upstream mirror {
		#server mizu.tailce5c0d.ts.net:8001;
		#server sora.tailce5c0d.ts.net:8001;
		server kagami.tailce5c0d.ts.net:8000;
	}

	upstream mirror_testing {
		server sora.tailce5c0d.ts.net:8002;
	}

	upstream git {
		server nagare.tailce5c0d.ts.net:3000;
	}

	upstream drive {
		server yama.tailce5c0d.ts.net:11000;
	}
	
	upstream shlink_estellastudiodev_com {
		server hashi.tailce5c0d.ts.net:8001;
	}

	upstream shlink_estella_id {
		server hashi.tailce5c0d.ts.net:8000;
	}

	upstream shlink_web_client {
		server sora.tailce5c0d.ts.net:8004;
	}

	upstream mgm_fe {
		server mgm-fe.tailce5c0d.ts.net:5173;
	}

	upstream mgm_be {
		server mgm-be.tailce5c0d.ts.net:8080;
	}

	upstream infisical {
		server kokoro.tailce5c0d.ts.net:8001;
	}

	#upstream n8n {
	#	server acheron-1.taile92515.ts.net:5678;
	#}

	upstream kaizin {
		server kaizin.framer.website:443;
	}

	upstream tenki_weather {
		#server acheron-1.taile92515.ts.net:8000;
		#server arch-t480s.tailce5c0d.ts.net:8000;
		server sora.tailce5c0d.ts.net:8000;
	}

	upstream tenki_weather_staging {
		#server acheron-1.taile92515.ts.net:8000;
		#server arch-t480s.tailce5c0d.ts.net:8000;
		server sora.tailce5c0d.ts.net:8001;
	}

	upstream script {
		server kagami.tailce5c0d.ts.net:8000;
	}

	upstream mc {
		server teikyo.tailce5c0d.ts.net:25565;
	}

	upstream atp_backend_prod {
		server sora.tailce5c0d.ts.net:5000;
	}

	server {
		listen 80;
		listen [::]:80;
		server_name _;
		return 301 https://$host$request_uri;
	}

	server {
		listen 80;
		server_name tenki.live;

		location /.well-known/acme-challenge/ {
			root /config/www;
		}

		location / {
			return 301 https://$host$request_uri;
		}
	}

	server {
		
		listen 443 ssl;
		server_name syafahadyan.com;

		ssl_certificate /config/etc/letsencrypt/live/syafahadyan.com/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/syafahadyan.com/privkey.pem;

		location / {
			proxy_pass https://personal_website_prod;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name iam.estella.id;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		location / {
			proxy_pass http://keycloak_prod;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name bcc-canteen.syafahadyan.com;

		ssl_certificate /config/etc/letsencrypt/live/syafahadyan.com/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/syafahadyan.com/privkey.pem;

		location /api/v1 {
			proxy_pass http://bcc_canteen_backend_prod;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name atr.estella.id atr.estellastudiodev.com leon.estellastudiodev.com;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		location /api/v1 {
			#proxy_pass $atr_backend_prod_proxy_upstream;
			#proxy_ssl_server_name on;
			#proxy_ssl_name $atr_backend_prod_sni_name;
			#proxy_set_header Host $atr_backend_prod_host_header;
			#proxy_pass http://atr_backend_prod_http;
			proxy_pass http://atr_backend_prod;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name atr-staging.estella.id;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		location /api/v1 {
			proxy_pass http://atr_backend_staging;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	#server {
	#	
	#	listen 443 ssl;
	#	server_name jenkins.syafahadyan.com;

	#	ssl_certificate /config/etc/letsencrypt/live/syafahadyan.com/fullchain.pem;
	#	ssl_certificate_key /config/etc/letsencrypt/live/syafahadyan.com/privkey.pem;

	#	location / {
	#		proxy_pass http://jenkins;
	#		proxy_set_header Host $host;
        #               proxy_set_header Upgrade $http_upgrade;
        #               proxy_set_header Connection $connection_upgrade;
	#		proxy_set_header X-Real-IP $remote_addr;
	#		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	#		proxy_set_header X-Forwarded-Proto $scheme;
	#	}
	#}

	server {
		listen 443 ssl;
		server_name pve.estella.id;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		location / {
			proxy_pass https://pve;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name pbs.estella.id;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		location / {
			proxy_pass https://pbs;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name router.estella.id;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		location / {
			proxy_pass http://router;
			proxy_set_header Host 10.0.0.1;
			#proxy_set_header Authorization $http_authorization;
			#proxy_set_header Upgrade $http_upgrade;
                        #proxy_set_header Connection $connection_upgrade;
			#proxy_set_header X-Real-IP $remote_addr;
			#proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			#proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name mc.estella.id;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		location / {
			proxy_pass http://mc;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	#server {
	#	listen 443 ssl;
	#	server_name atp.estella.id;

	#	ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
	#	ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

	#	location /api/loc{
	#		proxy_pass http://atp_backend_prod;
	#		proxy_set_header Host $host;
        #               proxy_set_header Upgrade $http_upgrade;
        #               proxy_set_header Connection $connection_upgrade;
	#		proxy_set_header X-Real-IP $remote_addr;
	#		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	#		proxy_set_header X-Forwarded-Proto $scheme;
	#	}
	#}

	#server {
	#	listen 443 ssl;
	#	server_name dev.estella.id;

	#	ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
	#	ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

	#	location / {
	#		proxy_pass http://wordpress;
	#		proxy_set_header Host $host;
        #               proxy_set_header Upgrade $http_upgrade;
        #               proxy_set_header Connection $connection_upgrade;
	#		proxy_set_header X-Real-IP $remote_addr;
	#		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	#		proxy_set_header X-Forwarded-Proto $scheme;
	#	}
	#}

	#server {
	#	
	#	listen 443 ssl;
	#	server_name idham.estella.id;

	#	ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
	#	ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

	#	location /interactions {
	#		proxy_pass http://filca;
	#		proxy_set_header Host $host;
        #               proxy_set_header Upgrade $http_upgrade;
        #               proxy_set_header Connection $connection_upgrade;
	#		proxy_set_header X-Real-IP $remote_addr;
	#		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	#		proxy_set_header X-Forwarded-Proto $scheme;
	#	}
	#}

	#server {
	#	
	#	listen 443 ssl;
	#	server_name sqrt.estella.id;

	#	ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
	#	ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

	#	location / {
	#		proxy_pass http://sqrt;
	#		proxy_set_header Host $host;
        #               proxy_set_header Upgrade $http_upgrade;
        #               proxy_set_header Connection $connection_upgrade;
	#		proxy_set_header X-Real-IP $remote_addr;
	#		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	#		proxy_set_header X-Forwarded-Proto $scheme;
	#	}
	#}

	#server {
	#	
	#	listen 443 ssl;
	#	server_name ai.estella.id;

	#	ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
	#	ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

	#	location / {
	#		proxy_pass http://ai;
	#		proxy_set_header Host $host;
        #               proxy_set_header Upgrade $http_upgrade;
        #               proxy_set_header Connection $connection_upgrade;
	#		proxy_set_header X-Real-IP $remote_addr;
	#		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	#		proxy_set_header X-Forwarded-Proto $scheme;
	#	}
	#}

	server {
		listen 80;
		listen 443 ssl;
		server_name mirror.syafahadyan.com;

		ssl_certificate /config/etc/letsencrypt/live/syafahadyan.com/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/syafahadyan.com/privkey.pem;

		location / {
			proxy_pass http://mirror;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 80;
		listen 443 ssl;
		server_name mirror.estella.id;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		location / {
			proxy_pass http://mirror;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name status.estella.id;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		location / {
			proxy_pass http://status;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name mirror-testing.syafahadyan.com;

		ssl_certificate /config/etc/letsencrypt/live/syafahadyan.com/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/syafahadyan.com/privkey.pem;

		location / {
			proxy_pass http://mirror_testing;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name git.estella.id;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		location / {
			proxy_pass http://git;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name drive.estella.id;
		
		proxy_buffering off;
		proxy_request_buffering off;
		proxy_redirect off;
		proxy_cache off;

		client_max_body_size 0;
		client_body_timeout 300s;
		fastcgi_buffers 64 4k;
		client_body_buffer_size 512k;
		proxy_read_timeout 86400s;

		gzip on;
		gzip_vary on;
		gzip_comp_level 4;
		gzip_min_length 256;
		gzip_proxied expired no-cache no-store private no_last_modified no_etag auth;
		gzip_types application/atom+xml text/javascript application/javascript application/json application/ld+json application/manifest+json application/rss+xml application/vnd.geo+json application/vnd.ms-fontobject application/wasm application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml application/xml font/opentype image/bmp image/svg+xml image/x-icon text/cache-manifest text/css text/plain text/vcard text/vnd.rim.location.xloc text/vtt text/x-component text/x-cross-domain-policy;

		add_header Referrer-Policy                   "no-referrer"       always;
		add_header X-Content-Type-Options            "nosniff"           always;
		add_header X-Frame-Options                   "SAMEORIGIN"        always;
		add_header X-Permitted-Cross-Domain-Policies "none"              always;
		add_header X-Robots-Tag                      "noindex, nofollow" always;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		server_tokens off;

		ssl_dhparam /config/nginx/dhparams.pem; # curl -L https://ssl-config.mozilla.org/ffdhe2048.txt -o /etc/dhparam

		ssl_early_data on;
		ssl_session_timeout 1d;
		ssl_session_cache shared:SSL:10m;

		ssl_protocols TLSv1.2 TLSv1.3;
		ssl_ecdh_curve x25519:x448:secp521r1:secp384r1:secp256r1;

		ssl_prefer_server_ciphers on;
		ssl_conf_command Options PrioritizeChaCha;
		ssl_ciphers TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-GCM-SHA256;

		location / {
			proxy_pass http://drive;
			#proxy_http_version 1.1;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header Early-Data $ssl_early_data;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
			proxy_set_header X-Forwarded-Port $server_port;
			proxy_set_header X-Forwarded-Scheme $scheme;
		}

		location /.well-known/carddav {
			return 301 $scheme://$host/remote.php/dav;
		}

		location /.well-known/caldav {
			return 301 $scheme://$host/remote.php/dav;
		}

		location ^~ /.well-known {
			return 301 $scheme://$host/index.php$uri;
		}
	}

	server {
		listen 443 ssl;
		server_name s.estellastudiodev.com;

		ssl_certificate /config/etc/letsencrypt/live/estellastudiodev.com/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estellastudiodev.com/privkey.pem;

		location / {
			proxy_pass http://shlink_estellastudiodev_com;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name s.estella.id;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		location / {
			proxy_pass http://shlink_estella_id;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name link.estella.id;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		location / {
			auth_basic "Auth";
			auth_basic_user_file /config/nginx/auth/htpasswd-shlink;
			proxy_pass http://shlink_web_client;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name mgm.estella.id;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		location / {
			proxy_pass http://mgm_fe;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}

		location /api {
			proxy_pass http://mgm_be;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name infisical.estella.id;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		location / {
			proxy_pass http://infisical;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	#server {
	#	listen 443 ssl;
	#	server_name n8n.estella.id;

	#	ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
	#	ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

	#	location / {
	#		proxy_pass http://n8n;
	#		proxy_set_header Host $host;
        #               proxy_set_header Upgrade $http_upgrade;
        #               proxy_set_header Connection $connection_upgrade;
	#		proxy_set_header X-Real-IP $remote_addr;
	#		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	#		proxy_set_header X-Forwarded-Proto $scheme;
	#	}
	#}

	server {
		listen 443 ssl;
		server_name tenki.live;
		#brotli on;
		#brotli_comp_level 5;
		#brotli_types text/plain text/css application/javascript application/json application/xml image/svg+xml;
		#brotli_static on;

		ssl_certificate /config/etc/letsencrypt/live/tenki.live/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/tenki.live/privkey.pem;

		location / {
			proxy_pass http://tenki_weather;
			proxy_set_header Host $host;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}

		location /.well-known/acme-challenge/ {
			root /config/www;
		}
	}

	server {
		listen 443 ssl;
		server_name tenki-staging.estella.id;
		#brotli on;
		#brotli_comp_level 5;
		#brotli_types text/plain text/css application/javascript application/json application/xml image/svg+xml;
		#brotli_static on;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		location / {
			proxy_pass http://tenki_weather_staging;
			proxy_set_header Host $host;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name script.syafahadyan.com;

		ssl_certificate /config/etc/letsencrypt/live/syafahadyan.com/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/syafahadyan.com/privkey.pem;

		location / {
			proxy_pass http://script;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name script.estella.id;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		location / {
			proxy_pass http://script;
			proxy_set_header Host $host;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection $connection_upgrade;
			proxy_set_header X-Real-IP $remote_addr;
			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
			proxy_set_header X-Forwarded-Proto $scheme;
		}
	}

	server {
		listen 443 ssl;
		server_name tenki.estella.id;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;
		
		rewrite ^/(.*)$ https://tenki.live/$1 permanent;
	}

	server {
		listen 443 ssl;
		server_name kaizin.estella.id;

		ssl_certificate /config/etc/letsencrypt/live/estella.id/fullchain.pem;
		ssl_certificate_key /config/etc/letsencrypt/live/estella.id/privkey.pem;

		rewrite ^/(.*)$ https://kaizin.framer.website/$1 permanent;
	}
}

daemon off;
pid /run/nginx.pid;
